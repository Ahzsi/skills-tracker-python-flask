<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Skills & Projects Tracker</title>

    <!-- Link to custom stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <!-- Optional: Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-yaj28VnSllzZQUkQDh3lH2O8P8F2FnjVuRZvnkl8ZpeXBPIBml+nI15nbL4rZHzcA3AunRG1N2CvGqS7ZuEA1g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div class="container">
        <!-- Navigation -->
        {% include '_nav.html' %}

        <h1>Projects Tracker</h1>

        <!-- Skills Section -->
        <div class="section">
            <h2>Skills</h2>
            <ul class="card-list" id="skills-list">
                {% for skill in tracker.skills %}
                  <li class="card skill-filter" data-skill="{{ skill.name }}">
                    {{ skill.name }}
                    <br>
                    <a
                      href="{{ url_for('skill_levels') }}?skill={{ skill.name }}"
                      title="View {{ skill.name }} in skill summary"
                      class="skill-link"
                    >
                      summary â†—
                    </a>
                  </li>
                {% else %}
                  <li class="card empty">No skills listed.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Projects Section -->
        <div class="section">
            <h2>Projects</h2>
            <p id="active-skill-label"></p>
            <ul class="card-list" id="project-list">
                {% for project in tracker.projects %}
                  <li class="card project" data-tech="{{ project.tech }}">
                    <div class="project-content">
                      <div class="project-info">
                        <strong>{{ project.title }}</strong><br>
                        <span class="tech">{{ project.tech }}</span>
                      </div>
                    </div>
                    {% if project.link %}
                        <div><a href="{{ project.link }}" target="_blank" class="project-link">View</a></div>
                    {% else %}
                        <span class="project-link-placeholder"></span>
                    {% endif %}
                  </li>
                {% else %}
                  <li class="card empty">No projects listed.</li>
                {% endfor %}
            </ul>
            <button id="clear-filter" style="display:none;">Clear Filter</button>
        </div>
    </div>

    <!-- JavaScript: Skill Filter Logic -->
    <script>
        const skills = document.querySelectorAll(".skill-filter");
        const projects = document.querySelectorAll(".project");
        const clearBtn = document.getElementById("clear-filter");
        const activeLabel = document.getElementById("active-skill-label");

        let selectedSkills = new Set();

        skills.forEach(skillEl => {
            skillEl.addEventListener("click", () => {
                const skill = skillEl.dataset.skill;

                if (selectedSkills.has(skill)) {
                    selectedSkills.delete(skill);
                    skillEl.classList.remove("active-skill");
                } else {
                    selectedSkills.add(skill);
                    skillEl.classList.add("active-skill");
                }

                updateFilteredProjects();
            });
        });

        clearBtn.addEventListener("click", () => {
            selectedSkills.clear();
            skills.forEach(s => s.classList.remove("active-skill"));
            updateFilteredProjects();
        });

        function updateFilteredProjects() {
            if (selectedSkills.size === 0) {
                projects.forEach(p => p.style.display = "flex");
                activeLabel.textContent = "";
                activeLabel.style.display = "none";
                clearBtn.style.display = "none";
            } else {
                const skillsArray = Array.from(selectedSkills).map(s => s.toLowerCase());

                projects.forEach(proj => {
                    const tech = proj.dataset.tech.toLowerCase();
                    const matches = skillsArray.every(skill => tech.includes(skill));
                    proj.style.display = matches ? "flex" : "none";
                });

                activeLabel.textContent = `Filtering by skills: ${Array.from(selectedSkills).join(", ")}`;
                activeLabel.style.display = "block";
                clearBtn.style.display = "inline-block";
            }
        }
    </script>
</body>
</html>
